<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
"http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Tester</title>
    <script language="javascript" type="text/javascript" src="js/jquery.min.js"></script>
	<script language="javascript" type="text/javascript" src="js/jquery.flot.js"></script>
	<script language="javascript" type="text/javascript" src="/socket.io/socket.io.js"></script>
	<script type="text/javascript" charset="utf-8">
	var socket = io.connect();
	var msgnum = 0;
	
	var source = "";
	var destination = "agv1.miskolc@dev.gammadigital.hu";
	//ezt a websockets module teszi majd bele
	var securityId = "";
	//agv_get_xy_req üzenetet reprezentáló osztály
	function agv_get_xy_req() {
		this.header = {
			protocol :"mcp5",
            name : "agv_get_xy_req",
            source : "",
            destination : "",
            session_id : "",
            security_id :""
		};
		this.data = {};
	}
	
	socket.on('connect', function () {
		
	});
	
	socket.on('succesfull login', function (msg) {
		source = msg.header.destination;
		securityId = msg.header.security_id;
		
	});
	
	socket.on('agv_get_xy_resp', function (agv_get_xy_resp) {
		//itt jó lenne ismerni hogy hogyan néz ki egy válasz ojjektum
		//de a kéréshez hasonlóan fel lehet venni a válasz ojjektumot is és
		//annak ismeretében már könnyű kiszedni a válaszból ami kell
		//kevés üzenetnél úgyis tudjuk mi van benne, többnél majd írunk generikusabbat
		//az alertet kiszedve kommentből, látszik hogy két másodpercenként jönnek a válaszok és dobják az alertet
		console.log(agv_get_xy_resp);
		$('#log').append("<b>agv_get_xy_resp</b>.header.session_id: " + agv_get_xy_resp.header.session_id + " <br/>" + 
				" X: " + agv_get_xy_resp.data.x +
				", Y: " + agv_get_xy_resp.data.y + 
				", Phi: " + agv_get_xy_resp.data.phi + "<br/>");
		/*
		alert("Üzenet érkezett, típusa:" + agv_get_xy_resp.header.name + " x:" + agv_get_xy_resp.data.x + 
				" y:" + agv_get_xy_resp.data.y + " phi:" + agv_get_xy_resp.data.phi); */
	});
	
	setInterval(function() {
		//ennyi az üzenetküldés 
		//dobunk (emit-tálunk :)) egy eseményt ami "agv_get_xy_req" típusú és egy új agv_get_xy_req ojjektum a paraméter
		//felparaméterezzük egy random sessionID-vel és mehet
		var agvGetXYReq = new agv_get_xy_req();
		agvGetXYReq.header.source = source;
		agvGetXYReq.header.destination = destination;
		agvGetXYReq.header.security_id = securityId;
		agvGetXYReq.header.session_id = "" + Math.floor(Math.random()*65535);
		socket.emit('agv_get_xy_req', agvGetXYReq);
		$('#log').append("<b>agv_get_xy_req</b>.header.session_id: " + agvGetXYReq.header.session_id + " <br/>");
	}, 1000);
	</script>
  </head>
  <body>
    <h1>Üzenetek</h1>
    <div id="log" style="width: 600px; height: 500px; border: 1px solid brown; overflow: auto;"></div>
  </body>
</html>
